{"revisions":{"1338012703407":{"ts":1338012703407,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"\n/**\n * Module dependencies.\n */\n\nvar express = require('express')\n  , routes = require('./routes');\n\nvar app = module.exports = express.createServer();\n\n// Configuration\n\napp.configure(function(){\n  app.set('views', __dirname + '/views');\n  app.set('view engine', 'jade');\n  app.use(express.bodyParser());\n  app.use(express.methodOverride());\n  app.use(app.router);\n  app.use(express.static(__dirname + '/public'));\n});\n\napp.configure('development', function(){\n  app.use(express.errorHandler({ dumpExceptions: true, showStack: true }));\n});\n\napp.configure('production', function(){\n  app.use(express.errorHandler());\n});\n\n// Routes\n\napp.get('/', routes.index);\n\napp.listen(3000, function(){\n  console.log(\"Express server listening on port %d in %s mode\", app.address().port, app.settings.env);\n});\n"]],"start1":0,"start2":0,"length1":0,"length2":800}]],"length":800},"1338020861210":{"contributors":[],"silentsave":false,"ts":1338020861210,"patch":[[{"diffs":[[0,"/', "],[-1,"routes.index"],[1,"function(req, res) {\n    res.render('post');\n    }"],[0,");\n\n"]],"start1":644,"start2":644,"length1":20,"length2":58}]],"length":838,"saved":false},"1338020884864":{"ts":1338020884864,"patch":[[{"diffs":[[0,"er('post"],[1,".html"],[0,"');\n    "]],"start1":681,"start2":681,"length1":16,"length2":21}]],"length":843,"saved":false},"1338020981746":{"ts":1338020981746,"patch":[[{"diffs":[[0,"res."],[-1,"render('"],[1,"sendfile(__dirname+'/views/"],[0,"post"]],"start1":673,"start2":673,"length1":16,"length2":35}]],"length":862,"saved":false},"1338021041745":{"contributors":[],"silentsave":false,"ts":1338021041745,"patch":[[{"diffs":[[0,"', '"],[-1,"jade"],[1,"htmk"],[0,"');\n"]],"start1":262,"start2":262,"length1":12,"length2":12}]],"length":862,"saved":false},"1338021043058":{"ts":1338021043058,"patch":[[{"diffs":[[0,"e', 'htm"],[-1,"k"],[1,"l"],[0,"');\n  ap"]],"start1":261,"start2":261,"length1":17,"length2":17}]],"length":862,"saved":false},"1338025184667":{"ts":1338025184667,"patch":[[{"diffs":[[0,"routes')"],[1,"\n  , io = require('socket.io')"],[0,";\n"],[-1,""],[0,"\nvar app"]],"start1":91,"start2":91,"length1":18,"length2":48},{"diffs":[[0,"ver();\n\n"],[1,"//global variable to store input parameter\nvar params;\n\n\n"],[0,"// Confi"]],"start1":176,"start2":176,"length1":16,"length2":73},{"diffs":[[0,"p.get('/"],[1,":id"],[0,"', funct"]],"start1":724,"start2":724,"length1":16,"length2":19},{"diffs":[[0," res) {\n"],[1,"    params = req.params.id;\n"],[0,"    res."]],"start1":751,"start2":751,"length1":16,"length2":44},{"diffs":[[0,");\n    });\n\n"],[1,"io = io.listen(app);\n\n"],[0,"app.listen(3"]],"start1":832,"start2":832,"length1":24,"length2":46},{"diffs":[[0,"s.env);\n"],[-1,""],[0,"});\n"],[1,"\n//usernames that are currently connected to char\nvar usernames = [];\n\n//rooms that are currently active\nvar rooms = [];\n\nio.sockets.on('connection', function(socket) {\n\n    socket.on('adduser', function(username) {\n    //store the username in the socket session for this client\n    socket.username = username;\n    //store room in the socket session\n    socket.room = params;\n    //store room in rooms array\n    rooms.push(params);\n    //add client username to global list\n    usernames.push(username);\n    //send client the room\n    socket.join(params);\n    //user added\n    socket.emit('userAdded',{username:'SERVER',room:socket.room, message: username + ' has connected', timestamp: new Date()});\n    });\n\n\n});\n\n\n\n\n\n\n\n\n\n"]],"start1":990,"start2":990,"length1":12,"length2":735}]],"length":1725,"saved":false},"1338025347875":{"ts":1338025347875,"patch":[[{"diffs":[[0,"ame:"],[-1,"'SERVER',"],[1,"username, "],[0,"room"]],"start1":1608,"start2":1608,"length1":17,"length2":18},{"diffs":[[0,"oom,"],[-1," message: username + ' has connected',"],[0," tim"]],"start1":1635,"start2":1635,"length1":46,"length2":8}]],"length":1688,"saved":false},"1338026134961":{"ts":1338026134961,"patch":[[{"diffs":[[0,"cket) {\n"],[1,"    \n    socket.emit('news', 'testdata');\n    "],[0,"\n    soc"]],"start1":1163,"start2":1163,"length1":16,"length2":62}]],"length":1734,"saved":false},"1338028946733":{"ts":1338028946733,"patch":[[{"diffs":[[0,"et.room,"],[1," usernames:usernames,"],[0," timesta"]],"start1":1677,"start2":1677,"length1":16,"length2":37}]],"length":1755,"saved":false},"1338030101563":{"ts":1338030101563,"patch":[[{"diffs":[[0," = [];\n\n"],[1,"//store message history\nvar history = [];\n\n"],[0,"io.socke"]],"start1":1116,"start2":1116,"length1":16,"length2":59},{"diffs":[[0,"    });\n"],[1,"    \n    socket.on('message', function(message) {\n        history.push(message);\n        \n    });\n"],[0,"\n\n});\n\n\n"]],"start1":1775,"start2":1775,"length1":16,"length2":114}]],"length":1896,"saved":false},"1338030567783":{"ts":1338030567783,"patch":[[{"diffs":[[0,"r added\n    "],[1,"io."],[0,"socket"],[1,"s.in(socket.room)"],[0,".emit('userA"]],"start1":1655,"start2":1655,"length1":30,"length2":50},{"diffs":[[0,");\n        \n"],[1,"       \n"],[0,"    });\n\n\n})"]],"start1":1881,"start2":1881,"length1":24,"length2":32}]],"length":1924,"saved":false},"1338033977761":{"ts":1338033977761,"patch":[[{"diffs":[[0,"ernames "],[-1,""],[0,""],[1,"in room\nvar localUser = {};\n\n\n//usernames "],[0,"that are"]],"start1":1007,"start2":1007,"length1":16,"length2":58},{"diffs":[[0,"ername;\n"],[1,"    \n"],[0,"    //st"]],"start1":1436,"start2":1436,"length1":16,"length2":21},{"diffs":[[0,"(username);\n"],[1,"    \n    //adding client to the room speicify array\n  \n    if(localUser[\"\"+params] === undefined)\n    {\n        localUser[\"\"+params] = [];\n        localUser[\"\"+params].push(username);\n    }\n    else\n    {\n        localUser[\"\"+params].push(username);\n    }\n    \n"],[0,"    //send c"]],"start1":1629,"start2":1629,"length1":24,"length2":285},{"diffs":[[0,"ernames:"],[-1,"usernames"],[1,"localUser[\"\"+params]"],[0,", timest"]],"start1":2059,"start2":2059,"length1":25,"length2":36}]],"length":2243,"saved":false},"1338037693049":{"contributors":[],"silentsave":false,"ts":1338037693049,"patch":[[{"diffs":[[0,"stor"],[-1,"e message"],[1,"ing room specific"],[0," his"]],"start1":1168,"start2":1168,"length1":17,"length2":25},{"diffs":[[0,"story = "],[-1,"[]"],[1,"{}"],[0,";\n\nio.so"]],"start1":1204,"start2":1204,"length1":18,"length2":18},{"diffs":[[0,"    "],[-1,"});\n    \n    socket.on('message', function(message) {\n        history.push(message);\n        "],[1,"if(history[\"\"+params] != undefined)\n    {\n        socket.emit('loadHistory',{history:history[\"\"+params]});\n    }\n    });\n    \n    socket.on('message', function(message) {\n        console.log(\"message\");\n        if(history[\"\"+params] === undefined)\n        {\n            history[\"\"+params] = [];\n            history[\"\"+params].push(message);\n        }\n        else\n        {\n            history[\"\"+params].push(message);\n        }\n         \n        io.sockets.in(socket.room).emit('updatechat',message);"],[0,"\n   "]],"start1":2122,"start2":2122,"length1":101,"length2":510}]],"length":2660,"saved":false},"1338038914450":{"ts":1338038914450,"patch":[[{"diffs":[[0,"date"],[-1,"chat"],[0,"',me"]],"start1":2609,"start2":2609,"length1":12,"length2":8}]],"length":2656,"saved":false},"1338040675380":{"ts":1338040675380,"patch":[[{"diffs":[[0,"ry',"],[-1,"{history:"],[0,"hist"]],"start1":2198,"start2":2198,"length1":17,"length2":8},{"diffs":[[0,"+params]"],[-1,"}"],[0,");\n    }"]],"start1":2212,"start2":2212,"length1":17,"length2":16}]],"length":2646,"saved":false},"1338041691770":{"ts":1338041691770,"patch":[[{"diffs":[[0,"usernames = "],[-1,"[]"],[1,"{}"],[0,";\n\n//rooms t"]],"start1":1098,"start2":1098,"length1":26,"length2":26},{"diffs":[[0,"sernames"],[-1,".push("],[1,"[username] = ["],[0,"username"],[-1,")"],[1,"]"],[0,";\n    \n "]],"start1":1624,"start2":1624,"length1":31,"length2":39},{"diffs":[[0,"essage);\n   "],[1," });\n\n    socket.on('disconnect', function() {\n    //remove username form the global username list\n    delete usernames[socket.username];\n    \n    //remove username form the localroom username list\n    delete localUser[\"\"+params];\n    \n    //update users list\n     //user added\n    io.sockets.in(socket.room).emit('userAdded',{username:username, room:socket.room, usernames:localUser[\"\"+params], timestamp: new Date()});\n"],[0,"    \n    });"]],"start1":2614,"start2":2614,"length1":24,"length2":445},{"diffs":[[0,"   });\n\n"],[-1,"\n"],[0,"});\n\n\n\n\n"]],"start1":3053,"start2":3053,"length1":17,"length2":16}]],"length":3074,"saved":false},"1338042061471":{"ts":1338042061471,"patch":[[{"diffs":[[0,"om:socket.room, "],[1," timestamp: new Date()});\n    io.sockets.in(socket.room).emit(\"updateUsers\", {"],[0,"usernames:localU"]],"start1":2057,"start2":2057,"length1":32,"length2":110},{"diffs":[[0,"+params]"],[-1,", timestamp: new Date()"],[0,"});\n    "]],"start1":2173,"start2":2173,"length1":39,"length2":16},{"diffs":[[0,"user"],[-1,"s "],[0,"list\n"],[-1,"     //user added\n"],[0,"    "]],"start1":2930,"start2":2930,"length1":33,"length2":13},{"diffs":[[0,"mit("],[-1,"'userAdded',{username:username, room:socket.room"],[1,"\"updateUsers\""],[0,", "],[1,"{"],[0,"user"]],"start1":2971,"start2":2971,"length1":58,"length2":24},{"diffs":[[0,"ams]"],[-1,", timestamp: new Date()});\n    "],[1,"});"],[0,"\n   "]],"start1":3017,"start2":3017,"length1":39,"length2":11}]],"length":3047,"saved":false},"1338042452484":{"ts":1338042452484,"patch":[[{"diffs":[[0,"ate()});\n   "],[1,"\n  "],[0," io.sockets."]],"start1":2090,"start2":2090,"length1":24,"length2":27}]],"length":3050,"saved":false},"1338042865857":{"ts":1338042865857,"patch":[[{"diffs":[[0,"unction() {\n"],[1,"        console.log(\"disconnect called\");\n"],[0,"    //remove"]],"start1":2719,"start2":2719,"length1":24,"length2":66}]],"length":3092,"saved":false},"1338043377987":{"ts":1338043377987,"patch":[[{"diffs":[[0,"name] = "],[-1,"["],[0,"username"],[-1,"]"],[0,";\n    \n "]],"start1":1637,"start2":1637,"length1":26,"length2":24},{"diffs":[[0,"+params]});\n"],[1,"    socket.leave(socket.room);\n"],[0,"    });\n\n});"]],"start1":3056,"start2":3056,"length1":24,"length2":55}]],"length":3121,"saved":false},"1338044044491":{"ts":1338044044491,"patch":[[{"diffs":[[0,"    "],[-1,"io."],[0,"socket"],[-1,"s.in(socket.room)"],[0,".emi"]],"start1":1985,"start2":1985,"length1":34,"length2":14},{"diffs":[[0,"m username list\n"],[1,"    console.log(localUser[\"\"+params]);\n"],[0,"    delete local"]],"start1":2886,"start2":2886,"length1":32,"length2":71}]],"length":3140,"saved":false},"1338044932457":{"ts":1338044932457,"patch":[[{"diffs":[[0,"er[\"\"+params] = "],[-1,"[]"],[1,"{}"],[0,";\n        localU"]],"start1":1774,"start2":1774,"length1":34,"length2":34},{"diffs":[[0,"r[\"\"+params]"],[-1,".push("],[1,"[username] = "],[0,"username"],[-1,")"],[0,";\n    }\n    "]],"start1":1810,"start2":1810,"length1":39,"length2":45},{"diffs":[[0,"ams]"],[-1,".push("],[1,"[username] = "],[0,"username"],[-1,")"],[0,";\n  "]],"start1":1890,"start2":1890,"length1":23,"length2":29}]],"length":3152,"saved":false},"1338044984062":{"ts":1338044984062,"patch":[[{"diffs":[[0,"+params]"],[1,"[socket.username]"],[0,";\n    \n "]],"start1":2976,"start2":2976,"length1":16,"length2":33}]],"length":3169,"saved":false},"1338045905732":{"ts":1338045905732,"patch":[[{"diffs":[[0,"\"+params]);\n"],[1,"    if( localUser[\"\"+params][socket.username] != undefined)\n    {\n    "],[0,"    delete l"]],"start1":2941,"start2":2941,"length1":24,"length2":94},{"diffs":[[0,"rname];\n    "],[1,"}"],[0,"\n    //updat"]],"start1":3065,"start2":3065,"length1":24,"length2":25},{"diffs":[[0,"te userlist\n"],[1,"    \n"],[0,"    io.socke"]],"start1":3089,"start2":3089,"length1":24,"length2":29},{"diffs":[[0,"+params]});\n"],[1,"    \n"],[0,"    socket.l"]],"start1":3180,"start2":3180,"length1":24,"length2":29}]],"length":3250,"saved":false},"1338046510505":{"ts":1338046510505,"patch":[[{"diffs":[[0,"ten("],[-1,"300"],[1,"8"],[0,"0, f"]],"start1":873,"start2":873,"length1":11,"length2":9}]],"length":3248,"saved":false},"1338046876245":{"ts":1338046876245,"patch":[[{"diffs":[[0,"ten("],[-1,"8"],[1,"300"],[0,"0, f"]],"start1":873,"start2":873,"length1":9,"length2":11}]],"length":3250,"saved":false},"1338046902688":{"contributors":[],"silentsave":false,"ts":1338046902688,"patch":[[{"diffs":[[0,"ten("],[-1,"300"],[1,"8"],[0,"0, f"]],"start1":873,"start2":873,"length1":11,"length2":9}]],"length":3248,"saved":false},"1338046912410":{"ts":1338046912410,"patch":[[{"diffs":[[0,"ten("],[-1,"8"],[1,"300"],[0,"0, f"]],"start1":873,"start2":873,"length1":9,"length2":11}]],"length":3250,"saved":false},"1338047351069":{"ts":1338047351069,"patch":[[{"diffs":[[0,"ten("],[-1,"300"],[1,"8"],[0,"0, f"]],"start1":873,"start2":873,"length1":11,"length2":9}]],"length":3248,"saved":false},"1338186512981":{"contributors":[],"silentsave":false,"ts":1338186512981,"patch":[[{"diffs":[[0,"Routes\n\n"],[1,"\n"],[0,"app.get("]],"start1":714,"start2":714,"length1":16,"length2":17},{"diffs":[[0,"t('/"],[-1,":id"],[0,"', f"]],"start1":729,"start2":729,"length1":11,"length2":8},{"diffs":[[0,"ams.id;\n"],[-1,"    "],[1,"\tres.sendfile(__dirname +'/views/index.html');\n    });\n\n\n\napp.get('/:id', function(req, res) {\n    params = req.params.id;\n\t"],[0,"res.send"]],"start1":777,"start2":777,"length1":20,"length2":140},{"diffs":[[0,"_dirname"],[1," "],[0,"+'/views"]],"start1":923,"start2":923,"length1":16,"length2":17},{"diffs":[[0,"en(app);"],[1,"\nvar port = process.env.PORT || 3000;"],[0,"\n\napp.li"]],"start1":975,"start2":975,"length1":16,"length2":53},{"diffs":[[0,"ten("],[-1,"80"],[1,"port"],[0,", fu"]],"start1":1029,"start2":1029,"length1":10,"length2":12},{"diffs":[[0," = {};\n\n"],[1,"\nfunction htmlEntities(str) {\n    return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;')\n                      .replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n}\n\n"],[0,"io.socke"]],"start1":1365,"start2":1365,"length1":16,"length2":187},{"diffs":[[0,"unction("],[-1,"usernam"],[1,"messag"],[0,"e) {\n   "]],"start1":1664,"start2":1664,"length1":23,"length2":22},{"diffs":[[0,"sage) {\n    "],[1,"\n\tvar username = htmlEntities(message);\n\n\t"],[0,"//store the "]],"start1":1675,"start2":1675,"length1":24,"length2":66},{"diffs":[[0,"\"+params] !="],[-1,""],[0,""],[1,"="],[0," undefined)\n"]],"start1":2562,"start2":2562,"length1":24,"length2":25},{"diffs":[[0,"on(m"],[-1,"essage) {\n        "],[1,"sg) {\n        msg.message = htmlEntities(msg.message);\n        msg.user = htmlEntities(msg.user);\n        msg.timstamp = new Date();\n\t\t"],[0,"cons"]],"start1":2698,"start2":2698,"length1":26,"length2":143},{"diffs":[[0,"+params]"],[-1,"[socket.username]"],[0,""],[1,""],[0," != unde"]],"start1":3459,"start2":3459,"length1":33,"length2":16},{"diffs":[[0,"});\n\n});"],[-1,"\n\n\n\n\n\n\n\n\n"],[0,""],[1,""],[0,"\n"]],"start1":3701,"start2":3701,"length1":18,"length2":9}]],"length":3710,"saved":false},"1338186848197":{"ts":1338186848197,"patch":[[{"diffs":[[0,"        "],[-1,"msg"],[1,"var message = {};\n        message"],[0,".message"]],"start1":2708,"start2":2708,"length1":19,"length2":49},{"diffs":[[0,"       m"],[-1,"sg"],[1,"essage"],[0,".user = "]],"start1":2788,"start2":2788,"length1":18,"length2":22},{"diffs":[[0,"   m"],[-1,"sg"],[1,"essage"],[0,".tim"],[1,"e"],[0,"stam"]],"start1":2839,"start2":2839,"length1":14,"length2":19}]],"length":3749,"saved":false},"1338196970791":{"contributors":[],"silentsave":false,"ts":1338196970791,"patch":[[{"diffs":[[0,"y array\n"],[-1,"  \n"],[0,"    if(l"]],"start1":2067,"start2":2067,"length1":19,"length2":16}]],"length":3746,"saved":false}}}